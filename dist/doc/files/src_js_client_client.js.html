<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\client\client.js - ozpIwc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="ozpIwc" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: launch-in-webtop</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/ozpIwc.alert.html">ozpIwc.alert</a></li>
                                <li><a href="../classes/ozpIwc.api.html">ozpIwc.api</a></li>
                                <li><a href="../classes/ozpIwc.api.base.Api.html">ozpIwc.api.base.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.base.Node.html">ozpIwc.api.base.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.data.Api.html">ozpIwc.api.data.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.data.node.Node.html">ozpIwc.api.data.node.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.data.node.Nodev2.html">ozpIwc.api.data.node.Nodev2</a></li>
                                <li><a href="../classes/ozpIwc.api.Endpoint.html">ozpIwc.api.Endpoint</a></li>
                                <li><a href="../classes/ozpIwc.api.EndpointRegistry.html">ozpIwc.api.EndpointRegistry</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadActionError.html">ozpIwc.api.error.BadActionError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadContentError.html">ozpIwc.api.error.BadContentError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadRequestError.html">ozpIwc.api.error.BadRequestError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadResourceError.html">ozpIwc.api.error.BadResourceError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BadStateError.html">ozpIwc.api.error.BadStateError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.BaseError.html">ozpIwc.api.error.BaseError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoActionError.html">ozpIwc.api.error.NoActionError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoMatchError.html">ozpIwc.api.error.NoMatchError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoPermissionError.html">ozpIwc.api.error.NoPermissionError</a></li>
                                <li><a href="../classes/ozpIwc.api.error.NoResourceError.html">ozpIwc.api.error.NoResourceError</a></li>
                                <li><a href="../classes/ozpIwc.api.filter.base.html">ozpIwc.api.filter.base</a></li>
                                <li><a href="../classes/ozpIwc.api.filter.Function.html">ozpIwc.api.filter.Function</a></li>
                                <li><a href="../classes/ozpIwc.api.filter.standard.html">ozpIwc.api.filter.standard</a></li>
                                <li><a href="../classes/ozpIwc.api.intents.Api.html">ozpIwc.api.intents.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.intents.FSM.html">ozpIwc.api.intents.FSM</a></li>
                                <li><a href="../classes/ozpIwc.api.Lifespan.Bound.html">ozpIwc.api.Lifespan.Bound</a></li>
                                <li><a href="../classes/ozpIwc.api.Lifespan.Ephemeral.html">ozpIwc.api.Lifespan.Ephemeral</a></li>
                                <li><a href="../classes/ozpIwc.api.Lifespan.Persistent.html">ozpIwc.api.Lifespan.Persistent</a></li>
                                <li><a href="../classes/ozpIwc.api.locks.Api.html">ozpIwc.api.locks.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.locks.Node.html">ozpIwc.api.locks.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.names.Api.html">ozpIwc.api.names.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.names.Node.html">ozpIwc.api.names.Node</a></li>
                                <li><a href="../classes/ozpIwc.api.system.Api.html">ozpIwc.api.system.Api</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.ApplicationNode.html">ozpIwc.api.system.node.ApplicationNode</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.ApplicationNodeV2.html">ozpIwc.api.system.node.ApplicationNodeV2</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.SystemNode.html">ozpIwc.api.system.node.SystemNode</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.UserNode.html">ozpIwc.api.system.node.UserNode</a></li>
                                <li><a href="../classes/ozpIwc.api.system.node.UserNodeV2.html">ozpIwc.api.system.node.UserNodeV2</a></li>
                                <li><a href="../classes/ozpIwc.apiMap.html">ozpIwc.apiMap</a></li>
                                <li><a href="../classes/ozpIwc.Client.html">ozpIwc.Client</a></li>
                                <li><a href="../classes/ozpIwc.Debugger.html">ozpIwc.Debugger</a></li>
                                <li><a href="../classes/ozpIwc.Lifespan.html">ozpIwc.Lifespan</a></li>
                                <li><a href="../classes/ozpIwc.log.html">ozpIwc.log</a></li>
                                <li><a href="../classes/ozpIwc.metric.Registry.html">ozpIwc.metric.Registry</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.BinaryHeap.html">ozpIwc.metric.stats.BinaryHeap</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.ExponentiallyDecayingSample.html">ozpIwc.metric.stats.ExponentiallyDecayingSample</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.Sample.html">ozpIwc.metric.stats.Sample</a></li>
                                <li><a href="../classes/ozpIwc.metric.stats.UniformSample.html">ozpIwc.metric.stats.UniformSample</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.BaseMetric.html">ozpIwc.metric.types.BaseMetric</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Counter.html">ozpIwc.metric.types.Counter</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Gauge.html">ozpIwc.metric.types.Gauge</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Histogram.html">ozpIwc.metric.types.Histogram</a></li>
                                <li><a href="../classes/ozpIwc.metric.types.Meter.html">ozpIwc.metric.types.Meter</a></li>
                                <li><a href="../classes/ozpIwc.network.KeyBroadcastLocalStorageLink.html">ozpIwc.network.KeyBroadcastLocalStorageLink</a></li>
                                <li><a href="../classes/ozpIwc.network.Peer.html">ozpIwc.network.Peer</a></li>
                                <li><a href="../classes/ozpIwc.packet.Fragment.html">ozpIwc.packet.Fragment</a></li>
                                <li><a href="../classes/ozpIwc.packet.FragmentStore.html">ozpIwc.packet.FragmentStore</a></li>
                                <li><a href="../classes/ozpIwc.packet.Network.html">ozpIwc.packet.Network</a></li>
                                <li><a href="../classes/ozpIwc.packet.Transport.html">ozpIwc.packet.Transport</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.elements.SecurityAttribute.html">ozpIwc.policyAuth.elements.SecurityAttribute</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.PDP.html">ozpIwc.policyAuth.points.PDP</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.PIP.html">ozpIwc.policyAuth.points.PIP</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.PRP.html">ozpIwc.policyAuth.points.PRP</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.points.utils.html">ozpIwc.policyAuth.points.utils</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.policies.html">ozpIwc.policyAuth.policies</a></li>
                                <li><a href="../classes/ozpIwc.policyAuth.PolicyCombining.html">ozpIwc.policyAuth.PolicyCombining</a></li>
                                <li><a href="../classes/ozpIwc.Timer.html">ozpIwc.Timer</a></li>
                                <li><a href="../classes/ozpIwc.transport.consensus.Base.html">ozpIwc.transport.consensus.Base</a></li>
                                <li><a href="../classes/ozpIwc.transport.consensus.Bully.html">ozpIwc.transport.consensus.Bully</a></li>
                                <li><a href="../classes/ozpIwc.transport.listener.SharedWorker.html">ozpIwc.transport.listener.SharedWorker</a></li>
                                <li><a href="../classes/ozpIwc.transport.PacketContext.html">ozpIwc.transport.PacketContext</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Base.html">ozpIwc.transport.participant.Base</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Client.html">ozpIwc.transport.participant.Client</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Debugger.html">ozpIwc.transport.participant.Debugger</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Internal.html">ozpIwc.transport.participant.Internal</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.Multicast.html">ozpIwc.transport.participant.Multicast</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.MutexClient.html">ozpIwc.transport.participant.MutexClient</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.PostMessage.html">ozpIwc.transport.participant.PostMessage</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.RouterWatchdog.html">ozpIwc.transport.participant.RouterWatchdog</a></li>
                                <li><a href="../classes/ozpIwc.transport.participant.SharedWorker.html">ozpIwc.transport.participant.SharedWorker</a></li>
                                <li><a href="../classes/ozpIwc.transport.Router.html">ozpIwc.transport.Router</a></li>
                                <li><a href="../classes/ozpIwc.util.html">ozpIwc.util</a></li>
                                <li><a href="../classes/ozpIwc.util.AjaxPersistenceQueue.html">ozpIwc.util.AjaxPersistenceQueue</a></li>
                                <li><a href="../classes/ozpIwc.util.ApiPromiseMixin.html">ozpIwc.util.ApiPromiseMixin</a></li>
                                <li><a href="../classes/ozpIwc.util.AsyncAction.html">ozpIwc.util.AsyncAction</a></li>
                                <li><a href="../classes/ozpIwc.util.CancelableEvent.html">ozpIwc.util.CancelableEvent</a></li>
                                <li><a href="../classes/ozpIwc.util.Event.html">ozpIwc.util.Event</a></li>
                                <li><a href="../classes/ozpIwc.util.mutex.html">ozpIwc.util.mutex</a></li>
                                <li><a href="../classes/ozpIwc.util.object.html">ozpIwc.util.object</a></li>
                                <li><a href="../classes/ozpIwc.util.PacketRouter.html">ozpIwc.util.PacketRouter</a></li>
                                <li><a href="../classes/ozpIwc.util.Reference.html">ozpIwc.util.Reference</a></li>
                                <li><a href="../classes/ozpIwc.wiring.html">ozpIwc.wiring</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ozpIwc.html">ozpIwc</a></li>
                                <li><a href="../modules/ozpIwc.api.html">ozpIwc.api</a></li>
                                <li><a href="../modules/ozpIwc.api.base.html">ozpIwc.api.base</a></li>
                                <li><a href="../modules/ozpIwc.api.data.html">ozpIwc.api.data</a></li>
                                <li><a href="../modules/ozpIwc.api.data.node.html">ozpIwc.api.data.node</a></li>
                                <li><a href="../modules/ozpIwc.api.error.html">ozpIwc.api.error</a></li>
                                <li><a href="../modules/ozpIwc.api.filter.html">ozpIwc.api.filter</a></li>
                                <li><a href="../modules/ozpIwc.api.intents.html">ozpIwc.api.intents</a></li>
                                <li><a href="../modules/ozpIwc.api.intents.node.html">ozpIwc.api.intents.node</a></li>
                                <li><a href="../modules/ozpIwc.api.locks.html">ozpIwc.api.locks</a></li>
                                <li><a href="../modules/ozpIwc.api.names.html">ozpIwc.api.names</a></li>
                                <li><a href="../modules/ozpIwc.api.system.html">ozpIwc.api.system</a></li>
                                <li><a href="../modules/ozpIwc.api.system.node.html">ozpIwc.api.system.node</a></li>
                                <li><a href="../modules/ozpIwc.metric.html">ozpIwc.metric</a></li>
                                <li><a href="../modules/ozpIwc.metric.stats.html">ozpIwc.metric.stats</a></li>
                                <li><a href="../modules/ozpIwc.metric.types.html">ozpIwc.metric.types</a></li>
                                <li><a href="../modules/ozpIwc.network.html">ozpIwc.network</a></li>
                                <li><a href="../modules/ozpIwc.packet.html">ozpIwc.packet</a></li>
                                <li><a href="../modules/ozpIwc.policyAuth.html">ozpIwc.policyAuth</a></li>
                                <li><a href="../modules/ozpIwc.policyAuth.elements.html">ozpIwc.policyAuth.elements</a></li>
                                <li><a href="../modules/ozpIwc.policyAuth.points.html">ozpIwc.policyAuth.points</a></li>
                                <li><a href="../modules/ozpIwc.transport.html">ozpIwc.transport</a></li>
                                <li><a href="../modules/ozpIwc.transport.consensus.html">ozpIwc.transport.consensus</a></li>
                                <li><a href="../modules/ozpIwc.transport.listener.html">ozpIwc.transport.listener</a></li>
                                <li><a href="../modules/ozpIwc.transport.participant.html">ozpIwc.transport.participant</a></li>
                                <li><a href="../modules/ozpIwc.util.html">ozpIwc.util</a></li>
                                <li><a href="../modules/ozpIwc.worker.html">ozpIwc.worker</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\js\client\client.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var ozpIwc = ozpIwc || {};

/**
 * @module ozpIwc
 */

ozpIwc.Client = (function (util) {

    /**
     * This class will be heavily modified in the future.
     * @class Client
     * @namespace ozpIwc
     * @constructor
     * @uses ozpIwc.util.ApiPromiseMixin
     * @todo accept a list of peer URLs that are searched in order of preference
     * @param {Object} config
     * @param {String} config.peerUrl - Base URL of the peer server
     * @param {Object} config.params - Parameters that will be passed to the bus.
     * @param {String} config.params.log - The IWC bus logging level.  One of &quot;NONE&quot;,&quot;DEFAULT&quot;,&quot;ERROR&quot;,&quot;INFO&quot;,&quot;DEBUG&quot;,
     *     or &quot;ALL&quot;
     * @param {Boolean} [config.autoConnect=true] - Whether to automatically find and connect to a peer
     */
    var Client = function (peerUrl, config) {

        var formattedConfig = formatConfig(peerUrl, config);

        if (formattedConfig.enhancedTimers) {
            util.enabledEnhancedTimers();
        }
        this.type = formattedConfig.type || &quot;default&quot;;

        var self = this;
        util.addEventListener(&#x27;beforeunload&#x27;, function () {
            self.disconnect();
        });
        genPeerUrlCheck(this, formattedConfig.peerUrl);
        util.ApiPromiseMixin(this, formattedConfig.autoConnect);

        if (util.globalScope.SharedWorker) {
            registerIntentHandlers(this);
        }
    };

    //----------------------------------------------------------
    // Private Properties
    //----------------------------------------------------------
    //

    /**
     * Takes in the various Client parameter options
     * ([string]),([object]),(string,[object]) and formats the config.
     * This is done to not break semver and force updated Client code.
     * @method formatConfig
     * @private
     * @static
     * @param  {[String|Object]} param1 Either the peer url to connect to ,the
     *                                    config object, or undefined to use
     *                                    default connection
     * @param  {[Object]} param2  If peer url string provided in param1, param2
     *                             is the optional config object. If param1 is the
     *                             config object param2 is ignored
     * @return {Object}         Formatted config object
     */
    var formatConfig = function(param1, param2){
        var newConfig = {};
        if(typeof param2 === &quot;object&quot;){
            newConfig = param2;
        }

        if(typeof param1 === &quot;object&quot;){
            //If the legacy style of config
            newConfig = param1;
            newConfig.peerUrl = newConfig.peerUrl || util.scriptDomain;
        } else if(typeof param1 === &quot;string&quot;) {
            // let the config object override the string url
            newConfig.peerUrl = newConfig.peerUrl || param1;
        } else {
            // default to assigning script&#x27;s domain as IWC domain.
            newConfig.peerUrl = util.scriptDomain;
        }
        return newConfig;
    };
    /**
     * A utility method for handshaking the client&#x27;s connection to the bus.
     * Resolves an external promise.
     * @method initPing
     * @private
     * @static
     * @param {Client} client
     * @param {Promise.resolve} resolve
     * @param {Promise.rej} reject
     */
    var initPing = function (client, resolve, reject) {
        client.send({dst: &quot;$transport&quot;, type: client.type}).then(function (response) {
            resolve(response);
        }).catch(function (err) {
            reject(err);
        });
    };

    /**
     * A handler function generator. Creates the post message event &quot;message&quot; handler for the client for its Iframe.
     * Requires an external promise resolve/reject reference to call when the client&#x27;s postMessage handler has connected
     * to the bus.
     *
     * @method genPostMessageHandler
     * @private
     * @static
     * @param {Client} client
     * @param {Promise.resolve} resolve
     * @param {Promise.rej} reject
     * @returns {Function}
     */
    var genPostMessageHandler = function (client, resolve, reject) {

        return function (event) {
            if (!client.peer || event.origin !== client.peerOrigin || event.source !== client.peer) {
                return;
            }
            try {
                var message = event.data;
                if (typeof(message) === &#x27;string&#x27;) {
                    message = JSON.parse(event.data);
                }
                // Calls APIPromiseMixin receive handler
                if (message.iwcInit &amp;&amp; client.address === &quot;$nobody&quot;) {
                    if(message.error) {
                        reject(message.error);
                    } else {
                        initPing(client, resolve, reject);
                    }
                } else {
                    client.receiveFromRouterImpl(message);
                    client.receivedBytes += (event.data.length * 2);
                    client.receivedPackets++;
                }
            } catch (e) {
                // ignore!
            }
        };
    };

    /**
     * Generates the Iframe for the client for IWC bus-domain communication.
     * Due to race condition issues with Chrome, this is an asynchronous task with a slight delay to prevent
     * broken bus connections with Chrome/SharedWorker.
     *
     * @method createIframeShim
     * @private
     * @static
     * @properties {Client} client
     */
    var createIframeShim = function (client, resolve, reject) {

        client.postMessageHandler = genPostMessageHandler(client, resolve, reject);
        util.addEventListener(&quot;message&quot;, client.postMessageHandler);

        setTimeout(function () {
            client.iframe = document.createElement(&quot;iframe&quot;);
            var url = client.peerUrl + &quot;/iframe_peer.html&quot;;
            if (client.launchParams.log) {
                url += &quot;?log=&quot; + client.launchParams.log;
            }
            if (client.type) {
                url += &quot;?type=&quot; + client.type;
            }
            client.iframe.src = url;
            client.iframe.height = 1;
            client.iframe.width = 1;
            client.iframe.setAttribute(&quot;area-hidden&quot;, true);
            client.iframe.setAttribute(&quot;hidden&quot;, true);
            client.iframe.style.setProperty(&quot;display&quot;, &quot;none&quot;, &quot;important&quot;);
            document.body.appendChild(client.iframe);
            client.peer = client.iframe.contentWindow;

            client.iframe.addEventListener(&quot;load&quot;, function () {
                initPing(client, resolve, reject);
            });
        }, 200);
    };

    /**
     * Generates the Peer URL checking logic based on the data type received.
     * @method genPeerUrlCheck
     * @private
     * @static
     * @param {Client} client
     * @param {String|Array|Function} configUrl the url(s) to connect the client on. If function, the output of the
     *                                   function will be used.
     */
    var genPeerUrlCheck = function (client, configUrl) {
        if (typeof(configUrl) === &quot;string&quot;) {
            client.peerUrlCheck = function (url) {
                if (typeof url !== &#x27;undefined&#x27;) {
                    return url;
                } else {
                    return configUrl;
                }

            };
        } else if (Array.isArray(configUrl)) {
            client.peerUrlCheck = function (url) {
                if (configUrl.indexOf(url) &gt;= 0) {
                    return url;
                }
                return configUrl[0];
            };
        } else if (typeof(configUrl) === &quot;function&quot;) {
            /**
             * @property peerUrlCheck
             * @type String
             */
            client.peerUrlCheck = configUrl;
        } else {
            throw new Error(&quot;PeerUrl must be a string, array of strings, or function&quot;);
        }
    };

    /**
     * Meta-data for registration to function with SharedWorkers.
     * @private
     * @static
     * @property sharedWorkerRegistrationData
     * @type {{contentType: string, entity: {label: string}}}
     */
    var sharedWorkerRegistrationData = {
        entity: {
            label: &#x27;SharedWorker\&#x27;s intent handler&#x27;
        }
    };

    /**
     * A utility method for Clients to register to handle application &amp; intent-chooser launching.
     * @method registerIntentHandlers
     * @private
     * @static
     * @param {Client} client
     */
    var registerIntentHandlers = function (client) {
        client.connect().then(function () {
            //-----------------------------------------
            // Intent Chooser Opening Intent Handler
            //-----------------------------------------
            var sharedWorkerIntentChooser = function (data) {
                var cfg = data.entity.config || {};
                util.openWindow(client.peerUrl + &quot;/&quot; + cfg.intentsChooserUri, {
                    &quot;ozpIwc.peer&quot;: client.peerUrl,
                    &quot;ozpIwc.intentSelection&quot;: cfg.intentSelection
                }, cfg.intentChooserFeatures);
            };
            var intentChooserResource = &#x27;/inFlightIntent/chooser/choose/&#x27; + client.address;
            client.intents().register(intentChooserResource, sharedWorkerRegistrationData, sharedWorkerIntentChooser);

            //-----------------------------------------
            // Application Launching Intent Handler
            //-----------------------------------------
            var sharedWorkerLauncher = function (data, inFlightIntent) {
                var cfg = data.entity || {};

                if (window === window.top || cfg.launchData.openInNewWindow) {
                    util.openWindow(cfg.url, {
                        &quot;ozpIwc.peer&quot;: client.peerUrl,
                        &quot;ozpIwc.inFlightIntent&quot;: inFlightIntent.resource
                    });
                } else {
                    var ref = new client.intents.Reference(&#x27;/application/iwc.internal/open&#x27;);
                    ref.broadcast(data);
                }
                return {intentIncomplete: true};
            };
            var launcherResource = &#x27;/application/vnd.ozp-iwc-launch-data-v1+json/run/&#x27; + client.address;
            client.intents().register(launcherResource, sharedWorkerRegistrationData, sharedWorkerLauncher);


            //-----------------------------------------
            // Application Highlight Intent Handler
            //-----------------------------------------
            var highlightHandler = function (data, inFlightIntent) {
                util.pulseWindow(client);
                util.pulseTitle(client);
            };
            var hilightResource = &#x27;/application/ozp-iwc/highlight/&#x27; + client.address;
            client.intents().register(hilightResource, sharedWorkerRegistrationData, highlightHandler);
        }).catch(function(err) {
            // Supress the error here, the application will get it from its
            // connect() call.
        });
    };

    //----------------------------------------------------------
    // Public Properties
    //----------------------------------------------------------

    /**
     * Disconnects the client from the IWC bus.
     *
     * @method disconnect
     */
    Client.prototype.disconnect = function () {
        var resolve, reject;
        var retPromise = new Promise(function (res, rej) {
            resolve = res;
            reject = rej;
        });
        if (this.iframe) {
            this.iframe.src = &quot;about:blank&quot;;
            var self = this;
            setTimeout(function () {
                if(self.iframe.remove){
                    self.iframe.remove();
                }
                self.iframe = null;
                resolve();
            }, 0);
        } else {
            reject();
        }

        return retPromise;
    };

    /**
     * Connects the client from the IWC bus.
     * Fires: {{#crossLink &quot;ozpIwc.Client/connected:event&quot;}}{{/crossLink}}
     *
     * @method connect
     */
    Client.prototype.connect = function () {
        if (!this.connectPromise) {
            var self = this;

            /**
             * Promise to chain off of for client connection asynchronous actions.
             * @property connectPromise
             * @type Promise
             */
            this.connectPromise = util.prerender().then(function () {
                // now that we know the url to connect to, find a peer element
                // currently, this is only via creating an iframe.
                self.peerUrl = self.peerUrlCheck(self.launchParams.peer);
                self.peerOrigin = util.determineOrigin(self.peerUrl);
                return self.createIframePeer();
            }).then(function (message) {
                self.address = message.dst;
                return self.afterConnected();
            });
        }
        return this.connectPromise;
    };

    /**
     * Creates an invisible iFrame Peer for IWC bus communication. Resolves when iFrame communication has been
     * initialized.
     *
     * @method createIframePeer
     * @returns {Promise}
     */
    Client.prototype.createIframePeer = function () {
        var self = this;
        return new Promise(function (resolve, reject) {
            // start listening to the bus and ask for an address

            // need at least the body tag to be loaded, so wait until it&#x27;s loaded
            if (document.readyState === &#x27;complete&#x27;) {
                createIframeShim(self, resolve, reject);
            } else {
                util.addEventListener(&quot;load&quot;, function () {
                    createIframeShim(self, resolve, reject);
                });
            }
        });
    };

    /**
     * Client to Bus sending implementation. Not to be used directly.
     * @private
     * @method sendImpl
     * @param {ozpIwc.TransportPacket} packet
     */
    Client.prototype.sendImpl = function (packet) {
        util.safePostMessage(this.peer, packet, &#x27;*&#x27;);
    };

    /**
     * Gathers the launch data passed to the opened application. Launch data can be passed as a query parameter, inside
     * window.name, or inside window.hash as long as it&#x27;s key is &quot;launchData&quot;.
     *
     * Promise resolve with the launchData object.
     *
     * @method getLaunchData
     * @returns {Promise}
     */
    Client.prototype.getLaunchData = function () {
        var self = this;
        return this.connect().then(function () {
            return self.launchParams.launchData;
        });
    };

    return Client;
}(ozpIwc.util));

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
