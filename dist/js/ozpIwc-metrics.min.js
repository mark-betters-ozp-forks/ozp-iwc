try{window||(window=self)}catch(a){window=self}!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.returnExports=b()}(this,function(){var a,b=Array,c=b.prototype,d=Object,e=d.prototype,f=Function.prototype,g=String,h=g.prototype,i=Number,j=i.prototype,k=c.slice,l=c.splice,m=c.push,n=c.unshift,o=c.concat,p=f.call,q=Math.max,r=Math.min,s=e.toString,t="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,u=Function.prototype.toString,v=function(a){try{return u.call(a),!0}catch(a){return!1}};a=function(a){if("function"!=typeof a)return!1;if(t)return v(a);var b=s.call(a);return"[object Function]"===b||"[object GeneratorFunction]"===b};var w,x=RegExp.prototype.exec,y=function(a){try{return x.call(a),!0}catch(a){return!1}};w=function(a){return"object"==typeof a&&(t?y(a):"[object RegExp]"===s.call(a))};var z,A=String.prototype.valueOf,B=function(a){try{return A.call(a),!0}catch(a){return!1}};z=function(a){return"string"==typeof a||"object"==typeof a&&(t?B(a):"[object String]"===s.call(a))};var C=function(a){var b,c=d.defineProperty&&function(){try{var a={};d.defineProperty(a,"x",{enumerable:!1,value:a});for(var b in a)return!1;return a.x===a}catch(a){return!1}}();return b=c?function(a,b,c,e){!e&&b in a||d.defineProperty(a,b,{configurable:!0,enumerable:!1,writable:!0,value:c})}:function(a,b,c,d){!d&&b in a||(a[b]=c)},function(c,d,e){for(var f in d)a.call(d,f)&&b(c,f,d[f],e)}}(e.hasOwnProperty),D=function(a){var b=typeof a;return null===a||"object"!==b&&"function"!==b},E=i.isNaN||function(a){return a!==a},F={ToInteger:function(a){var b=+a;return E(b)?b=0:0!==b&&b!==1/0&&b!==-1/0&&(b=(b>0||-1)*Math.floor(Math.abs(b))),b},ToPrimitive:function(b){var c,d,e;if(D(b))return b;if(d=b.valueOf,a(d)&&(c=d.call(b),D(c)))return c;if(e=b.toString,a(e)&&(c=e.call(b),D(c)))return c;throw new TypeError},ToObject:function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return d(a)},ToUint32:function(a){return a>>>0}},G=function(){};C(f,{bind:function(b){var c=this;if(!a(c))throw new TypeError("Function.prototype.bind called on incompatible "+c);for(var e,f=k.call(arguments,1),g=function(){if(this instanceof e){var a=c.apply(this,o.call(f,k.call(arguments)));return d(a)===a?a:this}return c.apply(b,o.call(f,k.call(arguments)))},h=q(0,c.length-f.length),i=[],j=0;j<h;j++)m.call(i,"$"+j);return e=Function("binder","return function ("+i.join(",")+"){ return binder.apply(this, arguments); }")(g),c.prototype&&(G.prototype=c.prototype,e.prototype=new G,G.prototype=null),e}});var H=p.bind(e.hasOwnProperty),I=p.bind(e.toString),J=p.bind(h.slice),K=p.bind(h.split),L=b.isArray||function(a){return"[object Array]"===I(a)},M=1!==[].unshift(0);C(c,{unshift:function(){return n.apply(this,arguments),this.length}},M),C(b,{isArray:L});var N=d("a"),O="a"!==N[0]||!(0 in N),P=function(a){var b=!0,c=!0;return a&&(a.call("foo",function(a,c,d){"object"!=typeof d&&(b=!1)}),a.call([1],function(){"use strict";c="string"==typeof this},"x")),!!a&&b&&c};C(c,{forEach:function(b){var c,d=F.ToObject(this),e=O&&z(this)?K(this,""):d,f=-1,g=F.ToUint32(e.length);if(arguments.length>1&&(c=arguments[1]),!a(b))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++f<g;)f in e&&(void 0===c?b(e[f],f,d):b.call(c,e[f],f,d))}},!P(c.forEach)),C(c,{map:function(c){var d,e=F.ToObject(this),f=O&&z(this)?K(this,""):e,g=F.ToUint32(f.length),h=b(g);if(arguments.length>1&&(d=arguments[1]),!a(c))throw new TypeError("Array.prototype.map callback must be a function");for(var i=0;i<g;i++)i in f&&(h[i]=void 0===d?c(f[i],i,e):c.call(d,f[i],i,e));return h}},!P(c.map)),C(c,{filter:function(b){var c,d,e=F.ToObject(this),f=O&&z(this)?K(this,""):e,g=F.ToUint32(f.length),h=[];if(arguments.length>1&&(d=arguments[1]),!a(b))throw new TypeError("Array.prototype.filter callback must be a function");for(var i=0;i<g;i++)i in f&&(c=f[i],(void 0===d?b(c,i,e):b.call(d,c,i,e))&&m.call(h,c));return h}},!P(c.filter)),C(c,{every:function(b){var c,d=F.ToObject(this),e=O&&z(this)?K(this,""):d,f=F.ToUint32(e.length);if(arguments.length>1&&(c=arguments[1]),!a(b))throw new TypeError("Array.prototype.every callback must be a function");for(var g=0;g<f;g++)if(g in e&&!(void 0===c?b(e[g],g,d):b.call(c,e[g],g,d)))return!1;return!0}},!P(c.every)),C(c,{some:function(b){var c,d=F.ToObject(this),e=O&&z(this)?K(this,""):d,f=F.ToUint32(e.length);if(arguments.length>1&&(c=arguments[1]),!a(b))throw new TypeError("Array.prototype.some callback must be a function");for(var g=0;g<f;g++)if(g in e&&(void 0===c?b(e[g],g,d):b.call(c,e[g],g,d)))return!0;return!1}},!P(c.some));var Q=!1;c.reduce&&(Q="object"==typeof c.reduce.call("es5",function(a,b,c,d){return d})),C(c,{reduce:function(b){var c=F.ToObject(this),d=O&&z(this)?K(this,""):c,e=F.ToUint32(d.length);if(!a(b))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===e&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var f,g=0;if(arguments.length>=2)f=arguments[1];else for(;;){if(g in d){f=d[g++];break}if(++g>=e)throw new TypeError("reduce of empty array with no initial value")}for(;g<e;g++)g in d&&(f=b(f,d[g],g,c));return f}},!Q);var R=!1;c.reduceRight&&(R="object"==typeof c.reduceRight.call("es5",function(a,b,c,d){return d})),C(c,{reduceRight:function(b){var c=F.ToObject(this),d=O&&z(this)?K(this,""):c,e=F.ToUint32(d.length);if(!a(b))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===e&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var f,g=e-1;if(arguments.length>=2)f=arguments[1];else for(;;){if(g in d){f=d[g--];break}if(--g<0)throw new TypeError("reduceRight of empty array with no initial value")}if(g<0)return f;do{g in d&&(f=b(f,d[g],g,c))}while(g--);return f}},!R);var S=c.indexOf&&-1!==[0,1].indexOf(1,2);C(c,{indexOf:function(a){var b=O&&z(this)?K(this,""):F.ToObject(this),c=F.ToUint32(b.length);if(0===c)return-1;var d=0;for(arguments.length>1&&(d=F.ToInteger(arguments[1])),d=d>=0?d:q(0,c+d);d<c;d++)if(d in b&&b[d]===a)return d;return-1}},S);var T=c.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);C(c,{lastIndexOf:function(a){var b=O&&z(this)?K(this,""):F.ToObject(this),c=F.ToUint32(b.length);if(0===c)return-1;var d=c-1;for(arguments.length>1&&(d=r(d,F.ToInteger(arguments[1]))),d=d>=0?d:c-Math.abs(d);d>=0;d--)if(d in b&&a===b[d])return d;return-1}},T);var U=function(){var a=[1,2],b=a.splice();return 2===a.length&&L(b)&&0===b.length}();C(c,{splice:function(a,b){return 0===arguments.length?[]:l.apply(this,arguments)}},!U);var V=function(){var a={};return c.splice.call(a,0,0,1),1===a.length}();C(c,{splice:function(a,b){if(0===arguments.length)return[];var c=arguments;return this.length=q(F.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof b&&(c=k.call(arguments),c.length<2?m.call(c,this.length-a):c[1]=F.ToInteger(b)),l.apply(this,c)}},!V);var W=function(){var a=new b(1e5);return a[8]="x",a.splice(1,1),7===a.indexOf("x")}(),X=function(){var a=[];return a[256]="a",a.splice(257,0,"b"),"a"===a[256]}();C(c,{splice:function(a,b){for(var c,d=F.ToObject(this),e=[],f=F.ToUint32(d.length),h=F.ToInteger(a),i=h<0?q(f+h,0):r(h,f),j=r(q(F.ToInteger(b),0),f-i),l=0;l<j;)c=g(i+l),H(d,c)&&(e[l]=d[c]),l+=1;var m,n=k.call(arguments,2),o=n.length;if(o<j){for(l=i;l<f-j;)c=g(l+j),m=g(l+o),H(d,c)?d[m]=d[c]:delete d[m],l+=1;for(l=f;l>f-j+o;)delete d[l-1],l-=1}else if(o>j)for(l=f-j;l>i;)c=g(l+j-1),m=g(l+o-1),H(d,c)?d[m]=d[c]:delete d[m],l-=1;l=i;for(var p=0;p<n.length;++p)d[l]=n[p],l+=1;return d.length=f-j+o,e}},!W||!X);var Y=!{toString:null}.propertyIsEnumerable("toString"),Z=function(){}.propertyIsEnumerable("prototype"),$=!H("x","0"),_=function(a){var b=a.constructor;return b&&b.prototype===a},aa={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0},ba=function(){if("undefined"==typeof window)return!1;for(var a in window)try{!aa["$"+a]&&H(window,a)&&null!==window[a]&&"object"==typeof window[a]&&_(window[a])}catch(a){return!0}return!1}(),ca=function(a){if("undefined"==typeof window||!ba)return _(a);try{return _(a)}catch(a){return!1}},da=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],ea=da.length,fa=function(a){return"[object Arguments]"===I(a)},ga=function(b){return null!==b&&"object"==typeof b&&"number"==typeof b.length&&b.length>=0&&!L(b)&&a(b.callee)},ha=fa(arguments)?fa:ga;C(d,{keys:function(b){var c=a(b),d=ha(b),e=null!==b&&"object"==typeof b,f=e&&z(b);if(!e&&!c&&!d)throw new TypeError("Object.keys called on a non-object");var h=[],i=Z&&c;if(f&&$||d)for(var j=0;j<b.length;++j)m.call(h,g(j));if(!d)for(var k in b)i&&"prototype"===k||!H(b,k)||m.call(h,g(k));if(Y)for(var l=ca(b),n=0;n<ea;n++){var o=da[n];l&&"constructor"===o||!H(b,o)||m.call(h,o)}return h}});var ia=d.keys&&function(){return 2===d.keys(arguments).length}(1,2),ja=d.keys&&function(){var a=d.keys(arguments);return 1!==arguments.length||1!==a.length||1!==a[0]}(1),ka=d.keys;C(d,{keys:function(a){return ka(ha(a)?k.call(a):a)}},!ia||ja);var la=Date.prototype.toISOString&&-1===new Date(-621987552e5).toISOString().indexOf("-000001"),ma=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString();C(Date.prototype,{toISOString:function(){var a,b,c,d,e;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(d=this.getUTCFullYear(),e=this.getUTCMonth(),d+=Math.floor(e/12),e=(e%12+12)%12,a=[e+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],d=(d<0?"-":d>9999?"+":"")+J("00000"+Math.abs(d),0<=d&&d<=9999?-4:-6),b=a.length;b--;)(c=a[b])<10&&(a[b]="0"+c);return d+"-"+k.call(a,0,2).join("-")+"T"+k.call(a,2).join(":")+"."+J("000"+this.getUTCMilliseconds(),-3)+"Z"}},la||ma),function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(-621987552e5).toJSON().indexOf("-000001")&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(a){return!1}}()||(Date.prototype.toJSON=function(b){var c=d(this),e=F.ToPrimitive(c);if("number"==typeof e&&!isFinite(e))return null;var f=c.toISOString;if(!a(f))throw new TypeError("toISOString property is not callable");return f.call(c)});var na=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),oa=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));if(isNaN(Date.parse("2000-01-01T00:00:00.000Z"))||oa||!na){var pa=Math.pow(2,31)-1,qa=(Math.floor(pa/1e3),E(new Date(1970,0,1,0,0,0,pa+1).getTime()));Date=function(a){var b=function(c,d,e,f,h,i,j){var k,l=arguments.length;if(this instanceof a){var m=i,n=j;if(qa&&l>=7&&j>pa){var o=Math.floor(j/pa)*pa,p=Math.floor(o/1e3);m+=p,n-=1e3*p}k=1===l&&g(c)===c?new a(b.parse(c)):l>=7?new a(c,d,e,f,h,m,n):l>=6?new a(c,d,e,f,h,m):l>=5?new a(c,d,e,f,h):l>=4?new a(c,d,e,f):l>=3?new a(c,d,e):l>=2?new a(c,d):l>=1?new a(c):new a}else k=a.apply(this,arguments);return D(k)||C(k,{constructor:b},!0),k},c=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),d=[0,31,59,90,120,151,181,212,243,273,304,334,365],e=function(a,b){var c=b>1?1:0;return d[b]+Math.floor((a-1969+c)/4)-Math.floor((a-1901+c)/100)+Math.floor((a-1601+c)/400)+365*(a-1970)},f=function(b){var c=0,d=b;if(qa&&d>pa){var e=Math.floor(d/pa)*pa,f=Math.floor(e/1e3);c+=f,d-=1e3*f}return i(new a(1970,0,1,0,0,c,d))};for(var h in a)H(a,h)&&(b[h]=a[h]);return C(b,{now:a.now,UTC:a.UTC},!0),b.prototype=a.prototype,C(b.prototype,{constructor:b},!0),C(b,{parse:function(b){var d=c.exec(b);if(d){var g,h=i(d[1]),j=i(d[2]||1)-1,k=i(d[3]||1)-1,l=i(d[4]||0),m=i(d[5]||0),n=i(d[6]||0),o=Math.floor(1e3*i(d[7]||0)),p=Boolean(d[4]&&!d[8]),q="-"===d[9]?1:-1,r=i(d[10]||0),s=i(d[11]||0);return l<(m>0||n>0||o>0?24:25)&&m<60&&n<60&&o<1e3&&j>-1&&j<12&&r<24&&s<60&&k>-1&&k<e(h,j+1)-e(h,j)&&(g=60*(24*(e(h,j)+k)+l+r*q),g=1e3*(60*(g+m+s*q)+n)+o,p&&(g=f(g)),-864e13<=g&&g<=864e13)?g:NaN}return a.parse.apply(this,arguments)}}),b}(Date)}Date.now||(Date.now=function(){return(new Date).getTime()});var ra=j.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0)),sa={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(a,b){for(var c=-1,d=b;++c<sa.size;)d+=a*sa.data[c],sa.data[c]=d%sa.base,d=Math.floor(d/sa.base)},divide:function(a){for(var b=sa.size,c=0;--b>=0;)c+=sa.data[b],sa.data[b]=Math.floor(c/a),c=c%a*sa.base},numToString:function(){for(var a=sa.size,b="";--a>=0;)if(""!==b||0===a||0!==sa.data[a]){var c=g(sa.data[a]);""===b?b=c:b+=J("0000000",0,7-c.length)+c}return b},pow:function a(b,c,d){return 0===c?d:c%2==1?a(b,c-1,d*b):a(b*b,c/2,d)},log:function(a){for(var b=0,c=a;c>=4096;)b+=12,c/=4096;for(;c>=2;)b+=1,c/=2;return b}};C(j,{toFixed:function(a){var b,c,d,e,f,h,j,k;if(b=i(a),(b=E(b)?0:Math.floor(b))<0||b>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(c=i(this),E(c))return"NaN";if(c<=-1e21||c>=1e21)return g(c);if(d="",c<0&&(d="-",c=-c),e="0",c>1e-21)if(f=sa.log(c*sa.pow(2,69,1))-69,h=f<0?c*sa.pow(2,-f,1):c/sa.pow(2,f,1),h*=4503599627370496,(f=52-f)>0){for(sa.multiply(0,h),j=b;j>=7;)sa.multiply(1e7,0),j-=7;for(sa.multiply(sa.pow(10,j,1),0),j=f-1;j>=23;)sa.divide(1<<23),j-=23;sa.divide(1<<j),sa.multiply(1,1),sa.divide(2),e=sa.numToString()}else sa.multiply(0,h),sa.multiply(1<<-f,0),e=sa.numToString()+J("0.00000000000000000000",2,2+b);return b>0?(k=e.length,e=k<=b?d+J("0.0000000000000000000",0,b-k+2)+e:d+J(e,0,k-b)+"."+J(e,k-b)):e=d+e,e}},ra),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?function(){var a=void 0===/()??/.exec("")[1],b=Math.pow(2,32)-1;h.split=function(c,d){var e=this;if(void 0===c&&0===d)return[];if(!w(c))return K(this,c,d);var f,g,h,i,j=[],l=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(c.sticky?"y":""),n=0,o=new RegExp(c.source,l+"g");e+="",a||(f=new RegExp("^"+o.source+"$(?!\\s)",l));var p=void 0===d?b:F.ToUint32(d);for(g=o.exec(e);g&&!((h=g.index+g[0].length)>n&&(m.call(j,J(e,n,g.index)),!a&&g.length>1&&g[0].replace(f,function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(g[a]=void 0)}),g.length>1&&g.index<e.length&&m.apply(j,k.call(g,1)),i=g[0].length,n=h,j.length>=p));)o.lastIndex===g.index&&o.lastIndex++,g=o.exec(e);return n===e.length?!i&&o.test("")||m.call(j,""):m.call(j,J(e,n)),j.length>p?arraySlice(j,0,p):j}}():"0".split(void 0,0).length&&(h.split=function(a,b){return void 0===a&&0===b?[]:K(this,a,b)});var ta=h.replace;(function(){var a=[];return"x".replace(/x(.)?/g,function(b,c){m.call(a,c)}),1===a.length&&void 0===a[0]})()||(h.replace=function(b,c){var d=a(c),e=w(b)&&/\)[*?]/.test(b.source);if(d&&e){var f=function(a){var d=arguments.length,e=b.lastIndex;b.lastIndex=0;var f=b.exec(a)||[];return b.lastIndex=e,m.call(f,arguments[d-2],arguments[d-1]),c.apply(this,f)};return ta.call(this,b,f)}return ta.call(this,b,c)});var ua=h.substr,va="".substr&&"b"!=="0b".substr(-1);C(h,{substr:function(a,b){var c=a;return a<0&&(c=q(this.length+a,0)),ua.call(this,c,b)}},va);var wa="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",xa="​",ya="["+wa+"]",za=new RegExp("^"+ya+ya+"*"),Aa=new RegExp(ya+ya+"*$"),Ba=h.trim&&(wa.trim()||!xa.trim());C(h,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return g(this).replace(za,"").replace(Aa,"")}},Ba),8===parseInt(wa+"08")&&22===parseInt(wa+"0x16")||(parseInt=function(a){var b=/^0[xX]/;return function(c,d){var e=g(c).trim(),f=i(d)||(b.test(e)?16:10);return a(e,f)}}(parseInt))}),function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.returnExports=b()}(this,function(){var a,b,c,d,e=Function.prototype.call,f=Object.prototype,g=e.bind(f.hasOwnProperty),h=e.bind(f.propertyIsEnumerable),i=e.bind(f.toString),j=g(f,"__defineGetter__");j&&(a=e.bind(f.__defineGetter__),b=e.bind(f.__defineSetter__),c=e.bind(f.__lookupGetter__),d=e.bind(f.__lookupSetter__)),Object.getPrototypeOf||(Object.getPrototypeOf=function(a){var b=a.__proto__;return b||null===b?b:"[object Function]"===i(a.constructor)?a.constructor.prototype:a instanceof Object?f:null});var k=function(a){try{return a.sentinel=0,0===Object.getOwnPropertyDescriptor(a,"sentinel").value}catch(a){return!1}};if(Object.defineProperty){var l=k({});if(!("undefined"==typeof document||k(document.createElement("div")))||!l)var m=Object.getOwnPropertyDescriptor}if(!Object.getOwnPropertyDescriptor||m){Object.getOwnPropertyDescriptor=function(a,b){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.getOwnPropertyDescriptor called on a non-object: "+a);if(m)try{return m.call(Object,a,b)}catch(a){}var e;if(!g(a,b))return e;if(e={enumerable:h(a,b),configurable:!0},j){var i=a.__proto__,k=a!==f;k&&(a.__proto__=f);var l=c(a,b),n=d(a,b);if(k&&(a.__proto__=i),l||n)return l&&(e.get=l),n&&(e.set=n),e}return e.value=a[b],e.writable=!0,e}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(a){return Object.keys(a)}),!Object.create){var n,o=!({__proto__:null}instanceof Object),p=function(){if(!document.domain)return!1;try{return!!new ActiveXObject("htmlfile")}catch(a){return!1}},q=function(){var a,b;return b=new ActiveXObject("htmlfile"),b.write("<script><\/script>"),b.close(),a=b.parentWindow.Object.prototype,b=null,a},r=function(){var a,b=document.createElement("iframe"),c=document.body||document.documentElement;return b.style.display="none",c.appendChild(b),b.src="javascript:",a=b.contentWindow.Object.prototype,c.removeChild(b),b=null,a};n=o||"undefined"==typeof document?function(){return{__proto__:null}}:function(){var a=p()?q():r();delete a.constructor,delete a.hasOwnProperty,delete a.propertyIsEnumerable,delete a.isPrototypeOf,delete a.toLocaleString,delete a.toString,delete a.valueOf;var b=function(){};return b.prototype=a,n=function(){return new b},new b},Object.create=function(a,b){var c,d=function(){};if(null===a)c=n();else{if("object"!=typeof a&&"function"!=typeof a)throw new TypeError("Object prototype may only be an Object or null");d.prototype=a,c=new d,c.__proto__=a}return void 0!==b&&Object.defineProperties(c,b),c}}var s=function(a){try{return Object.defineProperty(a,"sentinel",{}),"sentinel"in a}catch(a){return!1}};if(Object.defineProperty){var t=s({}),u="undefined"==typeof document||s(document.createElement("div"));if(!t||!u)var v=Object.defineProperty,w=Object.defineProperties}if(!Object.defineProperty||v){Object.defineProperty=function(e,g,h){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.defineProperty called on non-object: "+e);if("object"!=typeof h&&"function"!=typeof h||null===h)throw new TypeError("Property description must be an object: "+h);if(v)try{return v.call(Object,e,g,h)}catch(a){}if("value"in h)if(j&&(c(e,g)||d(e,g))){var i=e.__proto__;e.__proto__=f,delete e[g],e[g]=h.value,e.__proto__=i}else e[g]=h.value;else{if(!j&&("get"in h||"set"in h))throw new TypeError("getters & setters can not be defined on this javascript engine");"get"in h&&a(e,g,h.get),"set"in h&&b(e,g,h.set)}return e}}Object.defineProperties&&!w||(Object.defineProperties=function(a,b){if(w)try{return w.call(Object,a,b)}catch(a){}return Object.keys(b).forEach(function(c){"__proto__"!==c&&Object.defineProperty(a,c,b[c])}),a}),Object.seal||(Object.seal=function(a){if(Object(a)!==a)throw new TypeError("Object.seal can only be called on Objects.");return a}),Object.freeze||(Object.freeze=function(a){if(Object(a)!==a)throw new TypeError("Object.freeze can only be called on Objects.");return a});try{Object.freeze(function(){})}catch(a){Object.freeze=function(a){return function(b){return"function"==typeof b?b:a(b)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(a){if(Object(a)!==a)throw new TypeError("Object.preventExtensions can only be called on Objects.");return a}),Object.isSealed||(Object.isSealed=function(a){if(Object(a)!==a)throw new TypeError("Object.isSealed can only be called on Objects.");return!1}),Object.isFrozen||(Object.isFrozen=function(a){if(Object(a)!==a)throw new TypeError("Object.isFrozen can only be called on Objects.");return!1}),Object.isExtensible||(Object.isExtensible=function(a){if(Object(a)!==a)throw new TypeError("Object.isExtensible can only be called on Objects.");for(var b="";g(a,b);)b+="?";a[b]=!0;var c=g(a,b);return delete a[b],c})}),function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var c,g=e[a],h=g.deps,i=g.callback,j=[],k=0,l=h.length;k<l;k++)"exports"===h[k]?j.push(c={}):j.push(b(function(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;e<f;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}(h[k])));var m=i.apply(this,j);return f[a]=c||m}}(),a("promise/all",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a,c){g[a]=c,0==--h&&b(g)}var f,g=[],h=a.length;0===h&&b([]);for(var i=0;i<a.length;i++)f=a[i],f&&e(f.then)?f.then(function(a){return function(b){d(a,b)}}(i),c):d(i,f)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){"use strict";function b(){for(var a=0;a<h.length;a++){var b=h[a];(0,b[0])(b[1])}h=[]}function c(a,b){1===h.push([a,b])&&d()}var d,e="undefined"!=typeof window?window:{},f=e.MutationObserver||e.WebKitMutationObserver,g="undefined"!=typeof global?global:void 0===this?window:this,h=[];d="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){return function(){process.nextTick(b)}}():f?function(){var a=0,c=new f(b),d=document.createTextNode("");return c.observe(d,{characterData:!0}),function(){d.data=a=++a%2}}():function(){return function(){g.setTimeout(b,1)}}(),a.asap=c}),a("promise/config",["exports"],function(a){"use strict";function b(a,b){if(2!==arguments.length)return c[a];c[a]=b}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){"use strict";function d(){var a;"Promise"in(a="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self)&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),f(b)}()||(a.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!v(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],j(a,this)}function j(a,b){function c(a){o(b,a)}function d(a){q(b,a)}try{a(c,d)}catch(a){d(a)}}function k(a,b,c,d){var e,f,g,h,i=v(c);if(i)try{e=c(d),g=!0}catch(a){h=!0,f=a}else e=d,g=!0;n(b,e)||(i&&g?o(b,e):h?q(b,f):a===D?o(b,e):a===E&&q(b,e))}function l(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+D]=c,e[f+E]=d}function m(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],k(b,c,d,f);a._subscribers=null}function n(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(u(b)&&(d=b.then,v(d)))return d.call(b,function(d){if(c)return!0;c=!0,b!==d?o(a,d):p(a,d)},function(b){if(c)return!0;c=!0,q(a,b)}),!0}catch(b){return!!c||(q(a,b),!0)}return!1}function o(a,b){a===b?p(a,b):n(a,b)||p(a,b)}function p(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(r,a))}function q(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(s,a))}function r(a){m(a,a._state=D)}function s(a){m(a,a._state=E)}var t=a.config,u=(a.configure,b.objectOrFunction),v=b.isFunction,w=(b.now,c.all),x=d.race,y=e.resolve,z=f.reject,A=g.asap;t.async=A;var B=void 0,C=0,D=1,E=2;i.prototype={constructor:i,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;t.async(function(){k(c._state,d,e[c._state-1],c._detail)})}else l(this,d,a,b);return d},catch:function(a){return this.then(null,a)}},i.all=w,i.race=x,i.resolve=y,i.reject=z,h.Promise=i}),a("promise/race",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){"use strict";function b(a){return new this(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){"use strict";function b(a){return a&&"object"==typeof a&&a.constructor===this?a:new this(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){"use strict";function b(a){return c(a)||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}();var ozpIwc=ozpIwc||{};ozpIwc.util=function(a){return a.globalScope=function(){return this}(),a.generateId=function(){return Math.floor(4294967295*Math.random()).toString(16)},a.now=function(){return(new Date).getTime()},a.resolveUriTemplate=function(a,b,c){var d={"+":function(a){return a},"":function(a){return encodeURIComponent(a)}},e=a.replace(/\{([\+\#\.\/\;\?\&]?)(.+?)\}/g,function(a,e,f){return d[e](b[f]||c[f])}),f=e.indexOf("://");return f>0&&(f+=3),e.replace(/\/\//g,function(a,b){return b>f?"/":a})},a.eventListeners={},a.addEventListener=function(b,c){var d=a.eventListeners[b];d||(d=a.eventListeners[b]=[]),d.push(c),a.globalScope.addEventListener(b,c)},a.removeEventListener=function(b,c){var d=a.eventListeners[b];d&&(a.eventListeners[b]=d.filter(function(a){return a!==c})),a.globalScope.removeEventListener(b,c)},a.purgeEventListeners=function(){ozpIwc.util.object.eachEntry(a.eventListeners,function(b,c){c.forEach(function(c){a.globalScope.removeEventListener(b,c)})}),a.eventListeners={}},a.extend=function(a,b){if(!a||!a.prototype)throw ozpIwc.log.error("Cannot create a new class for ",b," due to invalid baseclass:",a),new Error("Cannot create a new class due to invalid baseClass.  Dependency not loaded first?");return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b},a.safePostMessage=function(b,c,d){try{var e=c;a.structuredCloneSupport||"string"==typeof e||(e=JSON.stringify(c)),b.postMessage(e,d)}catch(a){try{b.postMessage(JSON.stringify(c),d)}catch(a){ozpIwc.log.debug("Invalid call to postMessage: "+a.message)}}},a.structuredCloneSupport=function(){var b="postMessage"in a.globalScope;try{a.globalScope.postMessage({toString:function(){b=!1}},"*")}catch(a){}return b}(),a.clone=function(a){if(!Array.isArray(a)&&"object"!=typeof a)return a;try{return JSON.parse(JSON.stringify(a))}catch(a){ozpIwc.log.error(a)}},a.parseQueryParams=function(b){b=b||a.globalScope.location.search;for(var c,d={},e=/\??([^&=]+)=?([^&]*)/g;null!==(c=e.exec(b));)d[c[1]]=decodeURIComponent(c[2]);return d},a.addQueryParams=function(b,c){if("string"!=typeof b)throw new Error("url should be a string.");var d={};switch(typeof c){case"object":if(Array.isArray(c)){if(0===c.length)return b;for(var e in c)if("string"==typeof c[e]){var f=a.parseQueryParams(c[e]);for(var g in f)d[g]=f[g]}}else{if(0===Object.keys(c).length)return b;d=c}break;case"undefined":return b;default:if(0===c.length)return b;d=a.parseQueryParams(c)}var h="",i=b.split("#");if(i.length>2)throw new Error("Invalid url.");b=i[0],h=i[1]||"",-1===b.indexOf("?")?b+="?":b+="&";var j="";for(var k in d)b+=j+k+"="+d[k],j="&";return h.length>0&&(b+="#"+h),b},a.protocolPorts={"http:":"80","https:":"443","ws:":"80","wss:":"443"},a.determineOrigin=function(b){var c=document.createElement("a");if(c.href=b,c.origin)return c.origin;var d=c.protocol+"//"+c.hostname;return c.port&&a.protocolPorts[c.protocol]!==c.port&&(d+=":"+c.port),d},a.escapeRegex=function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},a.parseOzpUrl=function(a){var b=/^(?:(?:web\+ozp|ozp):\/\/)?([0-9a-zA-Z](?:[-.\w])*)(\/[^?#]*)(\?[^#]*)?(#.*)?$/.exec(decodeURIComponent(a));if(b){return{dst:b[1],resource:b[2],action:"get"}}return null},a.isIWCPacket=function(a){return"string"==typeof a.src&&"string"==typeof a.dst&&"number"==typeof a.ver&&"string"==typeof a.msgId},a.getInternetExplorerVersion=function(){var a,b,c=-1;return"Microsoft Internet Explorer"===navigator.appName?(a=navigator.userAgent,b=/MSIE ([0-9]{1,}[\.0-9]{0,})/,null!==b.exec(a)&&(c=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(a=navigator.userAgent,b=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/,null!==b.exec(a)&&(c=parseFloat(RegExp.$1))),c},a.prerender=function(){return a.runningInWorker?Promise.resolve():new Promise(function(a,b){void 0===document||void 0===document.visibilityState||"prerender"!==document.visibilityState&&"unload"!==document.visibilityState?a():document.addEventListener("visibilitychange",function b(c){"prerender"!==document.visibilityState&&(document.removeEventListener(b),a())})})},a.runningInWorker="undefined"!=typeof WorkerGlobalScope&&this instanceof WorkerGlobalScope,a.openWindow=function(b,c,d){if("object"==typeof c){var e="";for(var f in c)e+=f+"="+encodeURIComponent(c[f])+"&";c=e}try{a.globalScope.open(b,c,d)}catch(e){a.globalScope.open(b+"?"+c,null,d)}},a.promiseDelay=function(a){return new Promise(function(b){setTimeout(function(){b()},a)})},a.ifUndef=function(a,b){return void 0===a?b:a},a.getOrigin=function(){return location.origin?location.origin:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")},a}(ozpIwc.util||{});var ozpIwc=ozpIwc||{};ozpIwc.apiMap={"data.api":{address:"data.api",actions:["get","set","delete","watch","unwatch","list","bulkGet","collect","addChild","removeChild"]},"intents.api":{address:"intents.api",actions:["get","set","delete","watch","unwatch","list","bulkGet","collect","register","invoke","broadcast"]},"names.api":{address:"names.api",actions:["get","set","delete","watch","unwatch","list","bulkGet","collect"]},"system.api":{address:"system.api",actions:["get","set","delete","watch","unwatch","list","bulkGet","collect","launch"]},"locks.api":{address:"locks.api",actions:["get","watch","unwatch","list","lock","unlock","collect","bulkGet"]}};var ozpIwc=ozpIwc||{};ozpIwc.util=ozpIwc.util||{},ozpIwc.util.ApiPromiseMixin=function(a,b,c){var d=function(a,b){b=void 0===b||b,a.address=a.address||"$nobody",a.connect=a.connect||function(){return a.connectPromise=Promise.resolve(),a.connectPromise},a.events||(a.events=new c.Event,a.events.mixinOnOff(a));var e=d.getCore();for(var f in e)a[f]=e[f];a.readLaunchParams(c.globalScope.name),a.readLaunchParams(c.globalScope.location.search),a.readLaunchParams(c.globalScope.location.hash),d.registerEvents(a),a.constructApiFunctions(),b&&a.connect().catch(function(a){})};d.registerEvents=function(a){a.on("disconnect",function(){a.promiseCallbacks={},a.registeredCallbacks={},c.globalScope.removeEventListener("message",a.postMessageHandler,!1),a.connectPromise=null})},d.getCore=function(){return{
promiseCallbacks:{},msgIdSequence:0,receivedPackets:0,receivedBytes:0,sentPackets:0,sentBytes:0,startTime:c.now(),apiMap:a||{},wrapperMap:{},preconnectionQueue:[],launchParams:{},watchMsgMap:{},registeredCallbacks:{},launchedIntents:[],isConnected:function(){return"$nobody"!==this.address},readLaunchParams:function(a){for(var b,c=/ozpIwc.(\w+)=([^&#]+)/g;null!==(b=c.exec(a));){var d=decodeURIComponent(b[2]);try{d=JSON.parse(d)}catch(a){}this.launchParams[b[1]]=d}},receiveFromRouterImpl:function(a){var b=!1,c=a.packet||a;if(c.replyTo&&this.promiseCallbacks[c.replyTo]){var d=!1,e=function(){d=!0};this.promiseCallbacks[c.replyTo](c,e),d&&(this.cancelPromiseCallback(c.replyTo),b=!0)}if(!b&&c.replyTo&&this.registeredCallbacks[c.replyTo]){var f=!1,g=this,h=function(){f=!0,g.watchMsgMap[c.replyTo]&&"watch"===g.watchMsgMap[c.replyTo].action&&g.api(g.watchMsgMap[c.replyTo].dst).unwatch(g.watchMsgMap[c.replyTo].resource),g.cancelRegisteredCallback(c.replyTo)};b=this.registeredCallbacks[c.replyTo](c,h)}if(!b){if(c.src===this.address)return;"$bus.multicast"===c.dst?l(this,c)||this.events.trigger("busPacket",a):this.events.trigger("receive",a)}},constructApiFunctions:function(){for(var a in this.apiMap){var b=this.apiMap[a],c=b.address.replace(".api","");this.hasOwnProperty(c)&&this.apiMap[a].functionName!==c||function(a,b){a[c]=a.updateApi(b),a.apiMap[b]=a.apiMap[b]||{},a.apiMap[b].functionName=c}(this,b.address)}},gatherApiInformation:function(){var a=this;return this.send({dst:"names.api",action:"get",resource:"/api"}).then(function(a){if("ok"===a.response)return a.entity;throw a.response}).then(function(b){var c=[];return b.forEach(function(b){var d=a.send({dst:"names.api",action:"get",resource:b}).then(function(c){if("ok"!==c.response)throw c.response;var d=b.replace("/api/","");a.apiMap[d]=a.apiMap[d]||{},a.apiMap[d].address=d,a.apiMap[d].actions=c.entity.actions});c.push(d)}),Promise.all(c)})},cancelPromiseCallback:function(a){var b=!1;return a&&(delete this.promiseCallbacks[a],b=!0),b},cancelRegisteredCallback:function(a){var b=!1;return a&&(delete this.registeredCallbacks[a],delete this.watchMsgMap[a],b=!0),b},on:function(a,b){return"connected"===a&&this.isConnected()?void b(this):this.events.on.apply(this.events,arguments)},off:function(a,b){return this.events.off.apply(this.events,arguments)},intentInvocationHandling:function(a,b,c){var d,e,f=this;return c=c||function(){},b=b||{},e=b.entity?Promise.resolve(b):f.send({dst:"intents.api",action:"get",resource:b.resource}),e.then(function(b){return d=b,d.entity.invokePacket.msgId===a.msgId?(c(a),Promise.reject("ownInvoke")):f.send({dst:"intents.api",contentType:d.contentType,action:"set",resource:d.resource,entity:{handler:{resource:a.resource,address:f.address},me:Date.now(),state:"running"}})}).then(function(){return c(d.entity,b)}).then(function(a){return a&&a.intentIncomplete?Promise.resolve():f.send({dst:"intents.api",contentType:d.contentType,action:"set",resource:d.resource,entity:{reply:{entity:a||{},contentType:d.entity.intent.type},state:"complete"}})}).catch(function(a){if("ownInvoke"!==a)return console.error("Error in handling intent: ",a," -- Reporting error on in-flight intent node:",d.resource),f.send({dst:"intents.api",contentType:d.contentType,action:"set",resource:d.resource,entity:{reply:{entity:a.toString()||{},contentType:"text/plain"},state:"error"}})})},api:function(a){return this.wrapperMap[a]||this.updateApi(a)},updateApi:function(a){var b=function(){return b};if(this.wrapperMap[a]=b,this.apiMap.hasOwnProperty(a)){var c=this.apiMap[a],d=this;b.messageBuilder={},b.messageBuilder.bulkSend=function(a,b){return{packet:{dst:c.address,action:"bulkSend",resource:"/",entity:a},callback:b}},b.bulkSend=function(a,b){return function(c){var d=a(c);return b.send(d.packet,d.callback)}}(b.messageBuilder.bulkSend,this);for(var e=0;e<c.actions.length;++e){var f=c.actions[e];b.messageBuilder[f]=j(c.address,f,this),b[f]=i(b.messageBuilder[f],this)}b.Reference=function(a,b){this.resource=a,this.apiWrapper=d,this.defaultPacket={resource:this.resource},this.messageBuilder={};for(var e in b)this.defaultPacket[e]=b[e];for(var f=0;f<c.actions.length;++f){var g=c.actions[f];this.messageBuilder[g]=k(c.address,g,this.defaultPacket,this.apiWrapper),this[g]=i(this.messageBuilder[g],this)}},b.Reference.prototype.send=function(a,b){var c,d,e=this,f=new Promise(function(a,b){c=a,d=b}),g=function(a,c){var d=e.defaultPacket.fullCallback?a:a.entity;return"complete"===a.response||"update"===a.response||a.invokePacket||e.defaultPacket.collect?b(d,c,a):a.entity.newValue!==a.entity.oldValue?b(d,c,a):void 0};return this.apiWrapper.send(a,g,c,d),f.then(function(a){return e.defaultPacket.fullResponse?a:a.entity},function(a){throw e.defaultPacket.fullResponse?a:a.response})},b.Reference.prototype.updateDefaults=function(a){if("object"==typeof a)for(var b in a)this.defaultPacket[b]=a[b];return this}}return b.apiName=a,b},fixPacket:function(a){var b={ver:1,src:a.src||this.address,msgId:a.msgId||"p:"+this.msgIdSequence++,time:a.time||(new Date).getTime()};for(var d in a)b[d]=c.ifUndef(a[d],b[d]);return"$nobody"===b.src&&(b.src=this.address),b},registerResponses:function(a,b,c,d){var e=this;b&&(this.registeredCallbacks[a.msgId]=function(c,d){return!/(ok).*/.test(c.response)&&!/(bad|no).*/.test(c.response)&&(c.entity&&c.entity.inFlightIntent?e.intentInvocationHandling(a,c.entity.inFlightIntent,b):b(c,d,c),!0)}),"none"!==a.respondOn&&(this.promiseCallbacks[a.msgId]=function(b,f){"intents.api"===b.src&&"invoke"===a.action&&/(ok).*/.test(b.response)||"broadcast"===a.action&&/(complete).*/.test(b.response)||("intents.api"===b.src&&"broadcast"===a.action&&/(pending).*/.test(b.response)?(e.registeredCallbacks[a.msgId]&&(e.registeredCallbacks[a.msgId].handlers=b.entity.handlers||[],e.registeredCallbacks[a.msgId].pRes=c,e.registeredCallbacks[a.msgId].reply=b),f()):"$transport"===b.src||/(ok).*/.test(b.response)||/(complete).*/.test(b.response)?(f(),c(b)):/(bad|no).*/.test(b.response)&&(f(),d(b)))}),"watch"===a.action?this.watchMsgMap[a.msgId]=a:"unwatch"===a.action&&a.replyTo&&this.cancelRegisteredCallback(a.replyTo),"bulkSend"===a.action&&a.entity.forEach(function(a){e.registerResponses(a.packet,a.callback,a.res,a.rej)})},send:function(a,b,c,d){if(this.sendingBlocked)return Promise.resolve({response:"dropped"});var e=c,f=d,g=new Promise(function(a,b){e||f||(e=a,f=b)});if(!this.isConnected()&&"$transport"!==a.dst)return this.preconnectionQueue.push({fields:a,callback:b,promiseRes:e,promiseRej:f}),g;var h=this.fixPacket(a);return this.registerResponses(h,b,e,f),m(h),this.sendImpl(h),this.sentBytes+=h.length,this.sentPackets++,g},afterConnected:function(){var a=this;return a.preconnectionQueue.forEach(function(b){a.send(b.fields,b.callback,b.promiseRes,b.promiseRej)}),a.preconnectionQueue=[],!a.launchParams.inFlightIntent||a.internal?(a.events.trigger("connected"),Promise.resolve()):a.intents().get(a.launchParams.inFlightIntent).then(function(b){if(b&&b.entity&&b.entity.intent){var c=b.entity.entity||{};if("ok"===b.response)for(var d in c)a.launchParams[d]=c[d];a.intents().set(a.launchParams.inFlightIntent,{entity:{state:"complete"}}),a.launchParams.launchData&&a.launchParams.launchData.inFlightIntent&&a.launchedIntents.push(a.launchParams.launchData.inFlightIntent)}a.events.trigger("connected")}).catch(function(b){console.error(a.launchParams.inFlightIntent," not handled, reason: ",b),a.events.trigger("connected")})}}};var e=function(a,b){for(var c in a.launchedIntents){var d="/"+a.launchedIntents[c].entity.intent.type+"/"+a.launchedIntents[c].entity.intent.action;b.packet.resource===d&&(a.intentInvocationHandling(b.packet,a.launchedIntents[c],b.callback),delete a.launchedIntents[c])}},f=function(a){if(a.callback){var b=a.callback;a.callback=function(a,c){b(a,c),a=a||{},a.entity=a.entity||{},"error"!==a.entity.state&&"complete"!==a.entity.state||c()}}},g=function(a,b){var c=b.callback||function(){},d=a.registeredCallbacks;b.callback=function(b,e,f){if(d[f.replyTo]){var g=d[f.replyTo],h=g.handlers,i=function(a){var b=h.indexOf(a);b>-1&&h.splice(b,1),0===h.length&&(g.reply.entity=g.results,g.reply.response="complete",g.pRes(g.reply),e())};"complete"===f.response?(g.results=g.results||{},g.results[f.resource]=f.entity,i(f.resource)):f.entity&&"error"===f.entity.state&&a.registeredCallbacks[f.replyTo]?i(f.entity.handler.resource):c(f,e)}}},h=function(a,b){var c=a.apiWrapper||a;switch(b.packet.action){case"register":e(c,b);break;case"invoke":f(b);break;case"broadcast":g(c,b)}},i=function(a,b){return function(){var c=a.apply(this,arguments);return"intents.api"===c.packet.dst&&h(b,c),b.send(c.packet,c.callback)}},j=function(a,b,c){return function(d,e,f){var g=f,h=e;"function"==typeof e&&(g=e,h={});var i={dst:a,action:b,resource:d,entity:{}};for(var j in h)i[j]=h[j];var k,l,m=new Promise(function(a,b){k=a,l=b});return m.packet=c.fixPacket(i),m.callback=g,m.res=k,m.rej=l,m}},k=function(a,b,c,d){return function(e,f){var g=e,h=f;"function"==typeof e&&(h=e,g=void 0);var i=c;i.dst=a,i.action=b,i.entity=g;var j,k,l=new Promise(function(a,b){j=a,k=b});return l.packet=d.fixPacket(i),l.callback=h,l.res=j,l.rej=k,l}},l=function(a,b){switch(b.action){case"connect":return a.events.trigger("addressConnects",b.entity.address,b),!0;case"disconnect":return a.events.trigger("addressDisconnects",b.entity.address,b),!0}},m=function(a){return"bulkSend"===a.action&&(a.entity=a.entity.map(function(a){return{packet:a.packet}})),a};return d}(ozpIwc.apiMap,ozpIwc.log,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.util=ozpIwc.util||{},ozpIwc.util.CancelableEvent=function(){var a=function(a){a=a||{};for(var b in a)this[b]=a[b];this.canceled=!1,this.cancelReason=null};return a.prototype.cancel=function(a){return a=a||"Unknown",this.canceled=!0,this.cancelReason=a,this},a}();var ozpIwc=ozpIwc||{};ozpIwc.util=ozpIwc.util||{},ozpIwc.util.Event=function(a){var b=function(){this.events={}};return b.prototype.on=function(a,b,c){var d=b;return c&&(d=function(){b.apply(c,arguments)},d.ozpIwcDelegateFor=b),this.events[a]=this.events[a]||[],this.events[a].push(d),d},b.prototype.off=function(a,b){this.events[a]=(this.events[a]||[]).filter(function(a){return a!==b&&a.ozpIwcDelegateFor!==b})},b.prototype.trigger=function(b){var c=Array.prototype.slice.call(arguments,1);return c.length<1&&c.push(new a.CancelableEvent),(this.events[b]||[]).forEach(function(a){a.apply(this,c)}),c[0]},b.prototype.mixinOnOff=function(a){var b=this;a.on=function(){return b.on.apply(b,arguments)},a.off=function(){return b.off.apply(b,arguments)}},b}(ozpIwc.util),window.console&&console.log||(console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}});var ozpIwc=ozpIwc||{};ozpIwc.log=function(){return{NONE:{logLevel:!0,severity:0,name:"NONE"},DEFAULT:{logLevel:!0,severity:1,name:"DEFAULT"},ERROR:{logLevel:!0,severity:3,name:"ERROR"},INFO:{logLevel:!0,severity:6,name:"INFO"},DEBUG:{logLevel:!0,severity:7,name:"DEBUG"},ALL:{logLevel:!0,severity:10,name:"ALL"},threshold:3,setThreshold:function(a){if("number"==typeof a)ozpIwc.log.threshold=a;else{if("number"!=typeof a.severity)throw new TypeError("Threshold must be a number or one of the ozpIwc.log constants.  Instead got"+a);ozpIwc.log.threshold=a.severity}},log:function(a){!0===a.logLevel&&"number"==typeof a.severity?ozpIwc.log.logMsg(a,Array.prototype.slice.call(arguments,1)):ozpIwc.log.logMsg(ozpIwc.log.DEFAULT,Array.prototype.slice.call(arguments,0))},logMsg:function(a,b){if(!(a.severity>ozpIwc.log.threshold)&&console&&console.log){var c=b.reduce(function(a,b){return b instanceof Error?a+b.toString()+(b.stack?" -- "+b.stack:""):"object"==typeof b?a+JSON.stringify(b,null,2):a+b},"["+a.name+"] ");console.log(c)}},error:function(){ozpIwc.log.logMsg(ozpIwc.log.ERROR,Array.prototype.slice.call(arguments,0))},debug:function(){ozpIwc.log.logMsg(ozpIwc.log.DEBUG,Array.prototype.slice.call(arguments,0))},info:function(){ozpIwc.log.logMsg(ozpIwc.log.INFO,Array.prototype.slice.call(arguments,0))}}}();var ozpIwc=ozpIwc||{};ozpIwc.util=ozpIwc.util||{},ozpIwc.util.object=function(){return{eachEntry:function(a,b,c){var d=[];for(var e in a)d.push(b.call(c,e,a[e],a.hasOwnProperty(e)));return d},values:function(a,b){b=b||function(a,b){return!0};var c=[];for(var d in a)b(d,a[d])&&c.push(a[d]);return c}}}();var ozpIwc=ozpIwc||{};ozpIwc.util=ozpIwc.util||{},ozpIwc.util.PacketRouter=function(a,b){var c=function(){this.routes={},this.defaultRoute=function(){return!1},this.defaultSelf=this};return c.prototype.declareRoute=function(a,d,e){if(!a||!a.action||!a.resource)throw new Error("Bad route declaration: "+JSON.stringify(a,null,2));return a.handler=d,a.filters=a.filters||[],a.handlerSelf=e,a.uriTemplate=c.uriTemplate(a.resource),b.ensureArray(a.action).forEach(function(b){this.routes.hasOwnProperty(b)||(this.routes[b]=[]),this.routes[b].push(a)},this),this},c.prototype.filterChain=function(b,c,d,e,f,g){if(!g.length)return e.handler.call(f,b,c,d);var h=g.shift(),i=this,j=!1,k=h.call(f,b,c,d,function(){return j=!0,i.filterChain(b,c,d,e,f,g)});return j?a.debug("Filter returned ",k):a.debug("Filter did not call next() and did not throw an exception",h),k},c.prototype.routePacket=function(a,b,c,d){d=d||{};var e=d.action||a.action,f=d.resource||a.resource;if(!e||!f)return b.defaultRouteCause="nonRoutablePacket",this.defaultRoute.call(c,a,b,{});if(b=b||{},c=c||this.defaultSelf,!this.routes.hasOwnProperty(e))return b.defaultRouteCause="noAction",this.defaultRoute.call(c,a,b,{});for(var g=this.routes[e],h=0;h<g.length;++h){var i=g[h];if(i){var j=i.uriTemplate(f);if(j){c=i.handlerSelf||c;var k=i.filters.slice();return this.filterChain(a,b,j,i,c,k)}}}return b.defaultRouteCause="noResource",this.defaultRoute.call(c,a,b,{})},c.prototype.declareDefaultRoute=function(a){this.defaultRoute=a},c.uriTemplate=function(a){var b=[],c="^"+a.replace(/\{.+?\}|[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,function(a){if(1===a.length)return"\\"+a;var c=a.indexOf(":");return c>0?(b.push(a.slice(1,c)),"("+a.slice(c+1,-1)+")"):(b.push(a.slice(1,-1)),"([^/]+)")})+"$",d=new RegExp(c);return function(a){var c=d.exec(a);if(!c)return null;for(var e={},f=1;f<c.length;++f)e[b[f-1]]=c[f];return e}},c.mixin=function(a){var b=new c,d=Object.getPrototypeOf(a.prototype);d&&d.routePacket?b.defaultRoute=function(a,b){return d.routePacket.apply(this,arguments)}:b.defaultRoute=function(a,b){return!!this.defaultRoute&&this.defaultRoute.apply(this,arguments)},a.declareRoute=function(a,c){b.declareRoute(a,c)},a.prototype.routePacket=function(a,c){return b.routePacket(a,c,this)}},c}(ozpIwc.log,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.stats=ozpIwc.metric.stats||{},ozpIwc.metric.stats=function(a){return a.DEFAULT_POOL_SIZE=1028,a.Sample=function(){this.clear()},a.Sample.prototype.update=function(a){this.values.push(a)},a.Sample.prototype.clear=function(){this.values=[],this.count=0},a.Sample.prototype.size=function(){return this.values.length},a.Sample.prototype.getValues=function(){return this.values},a.UniformSample=ozpIwc.util.extend(a.Sample,function(b){a.Sample.apply(this),this.limit=b||a.DEFAULT_POOL_SIZE}),a.UniformSample.prototype.update=function(a){if(this.count++,this.size()<this.limit)this.values.push(a);else{var b=parseInt(Math.random()*this.count);b<this.limit&&(this.values[b]=a)}},a}(ozpIwc.metric.stats);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.stats=ozpIwc.metric.stats||{},ozpIwc.metric.stats.BinaryHeap=function(){var a=function(a){this.content=[],this.scoreFunction=a};return a.prototype={clone:function(){var b=new a(this.scoreFunction);return b.content=JSON.parse(JSON.stringify(this.content)),b},push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},peek:function(){return this.content[0]},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},remove:function(a){for(var b=this.content.length,c=0;c<b;c++)if(this.content[c]===a){var d=this.content.pop();return c!==b-1&&(this.content[c]=d,this.scoreFunction(d)<this.scoreFunction(a)?this.bubbleUp(c):this.sinkDown(c)),!0}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(a){for(var b=this.content[a];a>0;){var c=Math.floor((a+1)/2)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},sinkDown:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e=2*(a+1),f=e-1,g=null,h=null;if(f<b){var i=this.content[f];h=this.scoreFunction(i),h<d&&(g=f)}if(e<b){var j=this.content[e];this.scoreFunction(j)<(null===g?d:h)&&(g=e)}if(null===g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}}},a}();var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.stats=ozpIwc.metric.stats||{},ozpIwc.metric.stats=function(a){return a.DEFAULT_RESCALE_THRESHOLD=36e5,a.DEFAULT_DECAY_ALPHA=.015,a.ExponentiallyDecayingSample=ozpIwc.util.extend(a.Sample,function(b,c){a.Sample.apply(this),this.limit=b||a.DEFAULT_POOL_SIZE,this.alpha=c||a.DEFAULT_DECAY_ALPHA,this.rescaleThreshold=a.DEFAULT_RESCALE_THRESHOLD}),a.ExponentiallyDecayingSample.prototype.getValues=function(){for(var a,b=[],c=this.values.clone();void 0!==(a=c.pop());)b.push(a.val);return b},a.ExponentiallyDecayingSample.prototype.size=function(){return this.values.size()},a.ExponentiallyDecayingSample.prototype.newHeap=function(){return new a.BinaryHeap(function(a){return a.priority})},a.ExponentiallyDecayingSample.prototype.now=function(){return ozpIwc.util.now()},a.ExponentiallyDecayingSample.prototype.tick=function(){return this.now()/1e3},a.ExponentiallyDecayingSample.prototype.clear=function(){this.values=this.newHeap(),this.count=0,this.startTime=this.tick(),this.nextScaleTime=this.now()+this.rescaleThreshold},a.ExponentiallyDecayingSample.prototype.update=function(a,b){void 0===b?b=this.tick():b/=1e3;var c=this.weight(b-this.startTime)/Math.random(),d={val:a,priority:c};if(this.count<this.limit)this.count+=1,this.values.push(d);else{this.values.peek().priority<c&&(this.values.push(d),this.values.pop())}this.now()>this.nextScaleTime&&this.rescale()},a.ExponentiallyDecayingSample.prototype.weight=function(a){return Math.exp(this.alpha*a)},a.ExponentiallyDecayingSample.prototype.rescale=function(){this.nextScaleTime=this.now()+this.rescaleThreshold;var a=this.values.content,b=[],c=this.startTime;this.startTime=this.tick();for(var d=0;d<a.length;d++)b.push({val:a[d].val,priority:a[d].priority*Math.exp(-this.alpha*(this.startTime-c))});this.values.content=b},a}(ozpIwc.metric.stats);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.stats=ozpIwc.metric.stats||{},ozpIwc.metric.stats=function(a){return a.M1_ALPHA=1-Math.exp(-5/60),a.M5_ALPHA=1-Math.exp(-5/60/5),a.M15_ALPHA=1-Math.exp(-5/60/15),a.ExponentiallyWeightedMovingAverage=function(a,b){this.alpha=a,this.interval=b||5e3,this.currentRate=null,this.uncounted=0,this.lastTick=ozpIwc.util.now()},a.ExponentiallyWeightedMovingAverage.prototype.update=function(a){this.uncounted+=a||1,this.tick()},a.ExponentiallyWeightedMovingAverage.prototype.tick=function(){var a=ozpIwc.util.now(),b=a-this.lastTick;if(b>this.interval){this.lastTick=a-b%this.interval;for(var c=Math.floor(b/this.interval),d=0;d<c;++d){var e=this.uncounted/this.interval;this.uncounted=0,null!==this.currentRate?this.currentRate+=this.alpha*(e-this.currentRate):this.currentRate=e}}},a.ExponentiallyWeightedMovingAverage.prototype.rate=function(){return 1e3*this.currentRate},a}(ozpIwc.metric.stats);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.types=ozpIwc.metric.types||{},ozpIwc.metric.types.BaseMetric=function(){var a=function(){this.value=0,this.name="",this.unitName=""};return a.prototype.get=function(){return this.value},a.prototype.unit=function(a){return a?(this.unitName=a,this):this.unitName},a}();var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.types=ozpIwc.metric.types||{},ozpIwc.metric.types.Counter=function(a,b){var c=b.extend(a.BaseMetric,function(){a.BaseMetric.apply(this,arguments),this.value=0});return c.prototype.inc=function(a){return this.value+=a||1},c.prototype.dec=function(a){return this.value-=a||1},c}(ozpIwc.metric.types,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.types=ozpIwc.metric.types||{},ozpIwc.metric.types.Gauge=function(a,b){var c=b.extend(a.BaseMetric,function(b){a.BaseMetric.apply(this,arguments),this.callback=b});return c.prototype.set=function(a){return this.callback=a,this},c.prototype.get=function(){if(this.callback)return this.callback()},c}(ozpIwc.metric.types,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.types=ozpIwc.metric.types||{},ozpIwc.metric.types.Histogram=function(a,b,c){var d=c.extend(a.BaseMetric,function(){a.BaseMetric.apply(this,arguments),this.sample=new b.ExponentiallyDecayingSample,this.clear()});return d.prototype.clear=function(){this.sample.clear(),this.min=this.max=null,this.varianceMean=0,this.varianceM2=0,this.sum=0,this.count=0},d.prototype.mark=function(a,b){b=b||c.now(),this.sample.update(a,b),this.max=null===this.max?a:Math.max(this.max,a),this.min=null===this.min?a:Math.min(this.min,a),this.sum+=a,this.count++;var d=a-this.varianceMean;return this.varianceMean+=d/this.count,this.varianceM2+=d*(a-this.varianceMean),this.count},d.prototype.get=function(){var a=this.sample.getValues().map(function(a){return parseFloat(a)}).sort(function(a,b){return a-b}),b=function(b){var c=b*a.length;if(c>=a.length)return a[a.length-1];c=Math.max(0,c),c=Math.min(c,a.length+1);var d=a[Math.floor(c)-1],e=a[Math.floor(c)];return d+(c-Math.floor(c))*(e-d)};return{percentile10:b(.1),percentile25:b(.25),median:b(.5),percentile75:b(.75),percentile90:b(.9),percentile95:b(.95),percentile99:b(.99),percentile999:b(.999),variance:this.count<1?null:this.varianceM2/(this.count-1),mean:0===this.count?null:this.varianceMean,stdDev:this.count<1?null:Math.sqrt(this.varianceM2/(this.count-1)),count:this.count,sum:this.sum,max:this.max,min:this.min}},d}(ozpIwc.metric.types,ozpIwc.metric.stats,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.types=ozpIwc.metric.types||{},ozpIwc.metric.types.Meter=function(a,b,c){var d=c.extend(a.BaseMetric,function(){a.BaseMetric.apply(this,arguments),this.m1Rate=new b.ExponentiallyWeightedMovingAverage(b.M1_ALPHA),this.m5Rate=new b.ExponentiallyWeightedMovingAverage(b.M5_ALPHA),this.m15Rate=new b.ExponentiallyWeightedMovingAverage(b.M15_ALPHA),this.startTime=c.now(),this.value=0});return d.prototype.mark=function(a){return a=a||1,this.value+=a,this.m1Rate.update(a),this.m5Rate.update(a),this.m15Rate.update(a),this.value},d.prototype.get=function(){return{rate1m:this.m1Rate.rate(),rate5m:this.m5Rate.rate(),rate15m:this.m15Rate.rate(),rateMean:this.value/(c.now()-this.startTime)*1e3,count:this.value}},d.prototype.tick=function(){this.m1Rate.tick(),this.m5Rate.tick(),this.m15Rate.tick()},d}(ozpIwc.metric.types,ozpIwc.metric.stats,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.types=ozpIwc.metric.types||{},ozpIwc.metric.types.Timer=function(a,b){var c=b.extend(a.BaseMetric,function(){a.BaseMetric.apply(this,arguments),this.meter=new a.Meter,this.histogram=new a.Histogram});return c.prototype.mark=function(a,b){this.meter.mark(),this.histogram.mark(a,b)},c.prototype.start=function(){var a=this,c=b.now();return function(){var d=b.now();a.mark(d-c,d)}},c.prototype.time=function(a){var c=b.now();try{a()}finally{var d=b.now();this.mark(d-c,d)}},c.prototype.get=function(){var a=this.histogram.get(),b=this.meter.get();for(var c in b)a[c]=b[c];return a},c}(ozpIwc.metric.types,ozpIwc.util);var ozpIwc=ozpIwc||{};ozpIwc.metric=ozpIwc.metric||{},ozpIwc.metric.Registry=function(a){var b=function(){this.metrics={};var a=this;this.gauge("registry.metrics.types").set(function(){return Object.keys(a.metrics).length})},c=function(a,b,c){var d=a.metrics[b];return d?d instanceof c?d:null:(d=a.metrics[b]=new c,d.name=b,d)};return b.prototype.makeName=function(a){return Array.prototype.slice.call(a).join(".")},b.prototype.counter=function(b){return c(this,this.makeName(arguments),a.Counter)},b.prototype.meter=function(b){return c(this,this.makeName(arguments),a.Meter)},b.prototype.gauge=function(b){return c(this,this.makeName(arguments),a.Gauge)},b.prototype.histogram=function(b){return c(this,this.makeName(arguments),a.Histogram)},b.prototype.timer=function(b){return c(this,this.makeName(arguments),a.Timer)},b.prototype.register=function(a,b){return this.metrics[this.makeName(a)]=b,b},b.prototype.toJson=function(){var a={};for(var b in this.metrics){for(var c=b.split("."),d=a;c.length>1;){var e=c.shift();d=d[e]=d[e]||{}}d[c[0]]=this.metrics[b].get()}return a},b.prototype.allMetrics=function(){var a=[];for(var b in this.metrics)a.push(this.metrics[b]);return a},b}(ozpIwc.metric.types||{});
//# sourceMappingURL=ozpIwc-metrics.min.js.map